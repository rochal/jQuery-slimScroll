/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.6.5
 * 
 */(function(e){jQuery.fn.extend({slimScroll:function(t){var n={wheelStep:20,width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:"0.2",railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,scroll:0,touchScrollStep:200},r=e.extend(n,t);return this.each(function(){function T(e,t,n){var i=e;if(t){i=parseInt(E.css("top"))+e*parseInt(r.wheelStep)/100*E.outerHeight();var s=v.outerHeight()-E.outerHeight();i=Math.min(Math.max(i,0),s),E.css({top:i+"px"})}l=parseInt(E.css("top"))/(v.outerHeight()-E.outerHeight()),i=l*(v[0].scrollHeight-v.outerHeight());if(n){i=e;var u=i/v[0].scrollHeight*v.outerHeight();E.css({top:u+"px"})}v.scrollTop(i),k(),L()}function C(){f=Math.max(v.outerHeight()/v[0].scrollHeight*v.outerHeight(),p),E.css({height:f+"px"})}function k(){C(),clearTimeout(u);if(l==~~l){d=r.allowPageScroll;if(c!=l){var e=~~l==0?"top":"bottom";v.trigger("slimscroll",e)}}c=l;if(f>=v.outerHeight()){d=!0;return}E.stop(!0,!0).fadeIn("fast"),r.railVisible&&w.stop(!0,!0).fadeIn("fast")}function L(){r.alwaysVisible||(u=setTimeout(function(){(!r.disableFadeOut||!n)&&!i&&!s&&(E.fadeOut("slow"),w.fadeOut("slow"))},1e3))}var n,i,s,u,a,f,l,c,h="<div></div>",p=30,d=!1,v=e(this);if(v.parent().hasClass("slimScrollDiv")){if(t&&"scroll"in t){E=v.parent().find(".slimScrollBar"),w=v.parent().find(".slimScrollRail");var m=0,g=r.scroll;if(typeof g=="string")if(g.charAt(1)=="="){m=v.scrollTop();var y=g.charAt(0);g=parseInt(g.substr(2)),y=="-"&&(g*=-1),m+=g}else m=parseInt(g);else m=g;T(m,!1,!0)}return}var b=e(h).addClass(r.wrapperClass).css({position:"relative",overflow:"hidden",width:r.width,height:r.height});v.css({overflow:"hidden",width:r.width,height:r.height});var w=e(h).addClass(r.railClass).css({width:r.size,height:"100%",position:"absolute",top:0,display:r.alwaysVisible&&r.railVisible?"block":"none","border-radius":r.size,background:r.railColor,opacity:r.railOpacity,zIndex:90}),E=e(h).addClass(r.barClass).css({background:r.color,width:r.size,position:"absolute",top:0,opacity:r.opacity,display:r.alwaysVisible?"block":"none","border-radius":r.size,BorderRadius:r.size,MozBorderRadius:r.size,WebkitBorderRadius:r.size,zIndex:99}),S=r.position=="right"?{right:r.distance}:{left:r.distance};w.css(S),E.css(S),v.wrap(b),v.parent().append(E),v.parent().append(w),E.draggable({axis:"y",containment:"parent",start:function(){s=!0},stop:function(){s=!1,L()},drag:function(t){T(0,e(this).position().top,!1)}}),w.hover(function(){k()},function(){L()}),E.hover(function(){i=!0},function(){i=!1}),v.hover(function(){n=!0,k(),L()},function(){n=!1,L()}),v.bind("touchstart",function(e,t){e.originalEvent.touches.length&&(a=e.originalEvent.touches[0].pageY)}),v.bind("touchmove",function(e){e.originalEvent.preventDefault();if(e.originalEvent.touches.length){var t=(a-e.originalEvent.touches[0].pageY)/r.touchScrollStep;T(t,!0)}});var x=function(e){if(!n)return;var e=e||window.event,t=0;e.wheelDelta&&(t=-e.wheelDelta/120),e.detail&&(t=e.detail/3),T(t,!0),e.preventDefault&&!d&&e.preventDefault(),d||(e.returnValue=!1)},N=function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",x,!1),this.addEventListener("mousewheel",x,!1)):document.attachEvent("onmousewheel",x)};N(),C(),r.start=="bottom"?(E.css({top:v.outerHeight()-E.outerHeight()}),T(0,!0)):typeof r.start=="object"&&(T(e(r.start).position().top,null,!0),r.alwaysVisible||E.hide())}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);